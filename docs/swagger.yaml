openapi: 3.0.3
info:
  title: lernu.io Forum API
  version: "1.0.0"
  description: >
    Express + MongoDB backend for forum posts, comments, reactions, notifications, and auth.
servers:
  - url: http://localhost:4001
paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
              example: { "status": "ok" }

  /contact:
    post:
      summary: Send a contact message
      description: "Public contact form. Requires SMTP and CONTACT_EMAIL to be configured."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactRequest'
            example:
              name: Jane Doe
              email: jane@example.com
              subject: Partnership inquiry
              message: "Hi Lernu team, I'd like to discuss a collaboration."
      responses:
        "201":
          description: Submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
              example: { "message": "Message received" }
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example: { "message": "Subject is required" }
        "503":
          description: Service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example: { "message": "Contact form temporarily unavailable" }

  /auth/signup:
    post:
      summary: Create account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
            example:
              email: jane@example.com
              password: secret123
              username: janedoe
              displayName: Jane Doe
      responses:
        "200":
          description: Signed up
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: jane@example.com
              password: secret123
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        "401":
          $ref: '#/components/responses/Unauthorized'
  /auth/me:
    get:
      summary: Current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        "401":
          $ref: '#/components/responses/Unauthorized'
  /auth/logout:
    post:
      summary: Logout
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Logged out" }

  /categories:
    get:
      summary: List categories
      responses:
        "200":
          description: Categories
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items: { $ref: '#/components/schemas/Category' }
              example:
                categories:
                  - id: 66fbc3aa0f1b8d001232abcd
                    name: Questions
                    icon: "‚ùì"
                    color: "#f97316"

  /posts:
    get:
      summary: List feed (cursor paginated)
      parameters:
        - in: query
          name: categoryId
          schema: { type: string }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Posts page
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostPage'
              example:
                items:
                  - $ref: '#/components/examples/PostExample'
                nextCursor: "2025-12-07T13:01:00.123Z"
    post:
      summary: Create post
      description: "Send image URLs returned from /uploads/images (do not embed base64)."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostCreateRequest'
            example:
              title: "How to center a div?"
              content: "I can't get flex to work. Any tips?"
              categoryId: 66fbc3aa0f1b8d001232abcd
              tags: ["css", "help"]
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
        "401":
          $ref: '#/components/responses/Unauthorized'
  /posts/trending:
    get:
      summary: Trending posts
      parameters:
        - in: query
          name: window
          schema: { type: string, example: "24h" }
        - in: query
          name: limit
          schema: { type: integer, default: 3 }
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Trending
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'
  /posts/trending/tags:
    get:
      summary: Trending tags (topics)
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 25 }
      responses:
        "200":
          description: Trending tags
          content:
            application/json:
              schema:
                type: object
                properties:
                  topics:
                    type: array
                    items:
                      type: object
                      properties:
                        tag:
                          type: string
                        count:
                          type: integer
  /posts/{id}:
    get:
      summary: Get post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Post
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
        "404":
          $ref: '#/components/responses/NotFound'
    patch:
      summary: Update post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostUpdateRequest'
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
        "403":
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Post deleted" }
        "403":
          $ref: '#/components/responses/Forbidden'
  /posts/{id}/like:
    post:
      summary: Like post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Liked
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
    delete:
      summary: Unlike post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unliked
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
  /posts/{id}/bookmark:
    post:
      summary: Bookmark post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Bookmarked
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
    delete:
      summary: Remove bookmark
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unbookmarked
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
  /posts/{id}/share:
    post:
      summary: Increment share count
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Shared
          content:
            application/json:
              schema:
                type: object
                properties:
                  post:
                    $ref: '#/components/schemas/Post'
  /posts/{id}/report:
    post:
      summary: Report post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "201":
          description: Reported
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Report submitted" }

  /reels:
    get:
      summary: List reels (cursor paginated)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
        - in: query
          name: search
          schema: { type: string }
      responses:
        "200":
          description: Reels page
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Reel'
                  nextCursor:
                    type: string
                    nullable: true
    post:
      summary: Create reel
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReelCreateRequest'
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'
  /reels/{id}:
    get:
      summary: Get reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Reel
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'
    patch:
      summary: Update reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReelUpdateRequest'
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'
    delete:
      summary: Delete reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Reel deleted" }
  /reels/{id}/like:
    post:
      summary: Like reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Liked
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'
    delete:
      summary: Unlike reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unliked
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'
  /reels/{id}/bookmark:
    post:
      summary: Bookmark reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Bookmarked
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'
    delete:
      summary: Unbookmark reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unbookmarked
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'

  /course-categories:
    get:
      summary: List course categories
      responses:
        "200":
          description: Course categories
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items: { $ref: '#/components/schemas/CourseCategory' }
  /courses:
    get:
      summary: List courses (cursor paginated)
      parameters:
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: category
          schema: { type: string }
        - in: query
          name: difficulty
          schema: { type: string, enum: [beginner, intermediate, advanced] }
        - in: query
          name: featured
          schema: { type: boolean }
        - in: query
          name: enrolled
          schema: { type: boolean, description: "Only courses the current user enrolled in" }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 50 }
      responses:
        "200":
          description: Courses page
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/Course' }
                  nextCursor:
                    type: string
                    nullable: true
    post:
      summary: Create course
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseCreateRequest'
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  course: { $ref: '#/components/schemas/Course' }
  /courses/featured:
    get:
      summary: Featured courses
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 6, maximum: 12 }
      responses:
        "200":
          description: Featured courses
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/Course' }
  /courses/{slug}:
    get:
      summary: Get course by slug (includes lessons)
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Course
          content:
            application/json:
              schema:
                type: object
                properties:
                  course:
                    allOf:
                      - $ref: '#/components/schemas/Course'
                      - type: object
                        properties:
                          lessons:
                            type: array
                            items: { $ref: '#/components/schemas/CourseLesson' }
        "404":
          $ref: '#/components/responses/NotFound'
  /courses/{id}:
    patch:
      summary: Update course
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseUpdateRequest'
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  course: { $ref: '#/components/schemas/Course' }
    delete:
      summary: Delete course
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /courses/{id}/enroll:
    post:
      summary: Enroll in course
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "201":
          description: Enrolled
          content:
            application/json:
              schema:
                type: object
                properties:
                  enrolledAt: { type: string, format: date-time }
    delete:
      summary: Unenroll from course
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unenrolled
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /courses/{id}/lessons:
    get:
      summary: List lessons for a course
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Lessons
          content:
            application/json:
              schema:
                type: object
                properties:
                  lessons:
                    type: array
                    items: { $ref: '#/components/schemas/CourseLesson' }
    post:
      summary: Create lesson
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LessonCreateRequest'
      responses:
        "201":
          description: Created lesson
          content:
            application/json:
              schema:
                type: object
                properties:
                  lesson: { $ref: '#/components/schemas/CourseLesson' }
  /courses/{id}/lessons/{lessonId}:
    patch:
      summary: Update lesson
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: path
          name: lessonId
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LessonUpdateRequest'
      responses:
        "200":
          description: Updated lesson
          content:
            application/json:
              schema:
                type: object
                properties:
                  lesson: { $ref: '#/components/schemas/CourseLesson' }
    delete:
      summary: Delete lesson
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: path
          name: lessonId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted lesson
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /courses/{id}/progress:
    get:
      summary: Get course progress
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Progress
          content:
            application/json:
              schema:
                type: object
                properties:
                  progress: { $ref: '#/components/schemas/CourseProgress' }
  /courses/{id}/lessons/{lessonId}/complete:
    post:
      summary: Mark lesson complete
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: path
          name: lessonId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Completion recorded
          content:
            application/json:
              schema:
                type: object
                properties:
                  progress: { $ref: '#/components/schemas/CourseProgress' }
  /reels/{id}/view:
    post:
      summary: Increment reel view count
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                watchedSeconds:
                  type: number
                  description: "How many seconds were watched in this play session"
                  minimum: 0
                  maximum: 36000
            example:
              watchedSeconds: 42
      responses:
        "200":
          description: Viewed
          content:
            application/json:
              schema:
                type: object
                properties:
                  reel:
                    $ref: '#/components/schemas/Reel'

  /posts/{id}/comments:
    get:
      summary: List comments on post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Comments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'
  /comments/{id}/replies:
    get:
      summary: List replies for a comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Replies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'
  /comments:
    post:
      summary: Create comment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreateRequest'
            example:
              postId: 66fbc3aa0f1b8d001232abcd
              content: "You can center with justify-content: center"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
  /reels/{id}/comments:
    get:
      summary: List comments on reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Reel comments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentPage'
    post:
      summary: Add comment to reel
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreateRequest'
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
  /comments/{id}:
    patch:
      summary: Update comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentUpdateRequest'
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
    delete:
      summary: Delete comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Comment deleted" }
  /comments/{id}/like:
    post:
      summary: Like comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Liked
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
    delete:
      summary: Unlike comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unliked
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
  /comments/{id}/accept:
    post:
      summary: Accept comment as solution
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    $ref: '#/components/schemas/Comment'
  /comments/{id}/report:
    post:
      summary: Report comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "201":
          description: Reported
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Report submitted" }

  /notifications:
    get:
      summary: List notifications
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
        - in: query
          name: unreadOnly
          schema: { type: boolean }
      responses:
        "200":
          description: Notifications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationPage'
  /notifications/{id}/read:
    post:
      summary: Mark notification read
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Marked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "Notification read" }
  /notifications/read-all:
    post:
      summary: Mark all notifications read
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Marked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example: { "message": "All notifications read" }

  /users/{id}:
    get:
      summary: User profile + recent posts
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  recentPosts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'
    patch:
      summary: Update user (self or admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
  /users/search:
    get:
      summary: Search users for mentions/autocomplete
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 25 }
      responses:
        "200":
          description: Matching users
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
  /users/by-username/{username}:
    get:
      summary: User profile by username
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: username
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  recentPosts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'
        "404":
          $ref: '#/components/responses/NotFound'
  /users/by-username/{username}/posts:
    get:
      summary: Posts by username (paginated)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: username
          required: true
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Posts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostPage'
        "404":
          $ref: '#/components/responses/NotFound'
  /users/{id}/posts:
    get:
      summary: Posts by user (paginated)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Posts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostPage'
  /users/{id}/follow:
    post:
      summary: Follow a user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Followed
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
    delete:
      summary: Unfollow a user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Unfollowed
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
  /users/me/credits:
    get:
      summary: Get current AI credit balance
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current AI credits
          content:
            application/json:
              schema:
                type: object
                properties:
                  aiCredits:
                    type: integer
                    minimum: 0
        "401":
          $ref: '#/components/responses/Unauthorized'
  /search:
    get:
      summary: Search users and posts
      description: Returns mixed results for the query.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 25 }
      responses:
        "200":
          description: Results
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  posts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'

  /stats/community:
    get:
      summary: Community stats for sidebar
      responses:
        "200":
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityStats'
              example:
                activeOnline: 12
                postsToday: 34
                questionsSolved: 8

  /sitemap.xml:
    get:
      summary: Sitemap XML of posts
      description: Returns up to 5000 most recent posts with title slugs.
      responses:
        "200":
          description: XML sitemap
          content:
            application/xml:
              schema:
                type: string

  /uploads/images:
    post:
      summary: Upload images (up to 4)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                images:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        "201":
          description: Uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
  /uploads/profile:
    post:
      summary: Upload profile picture
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        "201":
          description: Uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
  /uploads/cover:
    post:
      summary: Upload cover photo
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        "201":
          description: Uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string

  /api/projects:
    get:
      summary: List projects
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, default: 20, maximum: 50 }
        - in: query
          name: status
          schema: { type: string, enum: [draft, in-progress, completed] }
        - in: query
          name: sort
          schema: { type: string, enum: [createdAt, updatedAt, title], default: updatedAt }
        - in: query
          name: order
          schema: { type: string, enum: [asc, desc], default: desc }
      responses:
        "200":
          description: Projects
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/Project' }
                  nextCursor:
                    type: string
                    nullable: true
    post:
      summary: Create project
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectCreateRequest'
      responses:
        "201":
          description: Created project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'

  /api/projects/generate-scenes:
    post:
      summary: Generate scenes from a script (topic optional)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateScenesRequest'
      responses:
        "200":
          description: Generated scenes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateScenesResponse'

  /api/projects/{projectId}/video:
    post:
      summary: Generate a video for a project
      description: |
        Starts video generation using the project's scenes (Veo-only). Returns a completed video URI when immediately available, otherwise an operation name to poll.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateVideoRequest'
      responses:
        "200":
          description: Video ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoGenerationResponse'
        "202":
          description: Video generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoGenerationResponse'

  /api/projects/{projectId}/video/status:
    get:
      summary: Check video generation status
      description: Poll the Veo operation until a video URI is available.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
        - in: query
          name: operationName
          required: false
          schema: { type: string }
      responses:
        "200":
          description: Current status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoStatusResponse'

  /api/ai/script:
    post:
      summary: Generate a script with AI
      description: |
        Returns a plain-text faceless video script sized to the selected duration. Requires authentication and consumes 1 AI credit per request.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateScriptRequest'
      responses:
        "200":
          description: Generated script
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateScriptResponse'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/OutOfCredits'

  /api/ai/conversations:
    get:
      summary: List AI conversations
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          required: false
          schema: { type: integer, maximum: 100 }
      responses:
        "200":
          description: User conversations
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversations:
                    type: array
                    items:
                      $ref: '#/components/schemas/AiConversationListItem'
        "401":
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Create a new conversation
      security:
        - bearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAiConversationRequest'
      responses:
        "201":
          description: Conversation created
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation:
                    allOf:
                      - $ref: '#/components/schemas/AiConversation'
                      - type: object
                        properties:
                          messages:
                            type: array
                            items:
                              $ref: '#/components/schemas/AiConversationMessage'
        "401":
          $ref: '#/components/responses/Unauthorized'

  /api/ai/conversations/{id}:
    get:
      summary: Get a conversation with messages
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Conversation detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation:
                    $ref: '#/components/schemas/AiConversationWithMessages'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          $ref: '#/components/responses/NotFound'
    patch:
      summary: Update conversation metadata
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAiConversationRequest'
      responses:
        "200":
          description: Updated conversation
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation:
                    $ref: '#/components/schemas/AiConversation'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete a conversation
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          $ref: '#/components/responses/NotFound'

  /api/ai/conversations/{id}/messages:
    post:
      summary: Append a message to a conversation
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAiMessageRequest'
      responses:
        "201":
          description: Message created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    $ref: '#/components/schemas/AiConversationMessage'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          $ref: '#/components/responses/NotFound'

  /api/ai/video-from-script:
    post:
      summary: Generate video sequences from a script
      description: |
        Splits a script into sequences (voiceover + image/b-roll prompts) for downstream video creation. No video rendering is triggered here.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VideoFromScriptRequest'
      responses:
        "200":
          description: Generated sequences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoFromScriptResponse'

  /api/ai/videos:
    get:
      summary: List generated video sequences
      description: Paginated list of saved video generations (script, sequences, style, optional videoUri)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 50 }
      responses:
        "200":
          description: Video generations
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/VideoGenerationItem' }
                  nextCursor:
                    type: string
                    nullable: true

  /api/ai/videos/{id}/process:
    post:
      summary: Process a generated video (audio + image creation)
      description: Starts processing a saved video generation to create audio/image data URIs for each sequence.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Processing state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoGenerationStatus'

  /api/ai/videos/{id}/status:
    get:
      summary: Check video generation processing status
      description: Returns status/progress and videoUri (if available) for a saved video generation.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoGenerationStatus'

  /api/ai/video-from-script:
    post:
      summary: Generate video sequences from a script
      description: |
        Splits a script into sequences (voiceover + image/b-roll prompts) for downstream video creation. No video rendering is triggered here.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VideoFromScriptRequest'
      responses:
        "200":
          description: Generated sequences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoFromScriptResponse'

  /api/ai/videos:
    get:
      summary: List generated video sequences
      description: Paginated list of saved video generations (script, sequences, style, optional videoUri)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 50 }
      responses:
        "200":
          description: Video generations
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/VideoGenerationItem' }
                  nextCursor:
                    type: string
                    nullable: true

  /api/projects/{id}:
    get:
      summary: Get project
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        "404":
          $ref: '#/components/responses/NotFound'
    patch:
      summary: Update project
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectUpdateRequest'
      responses:
        "200":
          description: Updated project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        "404":
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete project
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "404":
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectId}/scenes:
    post:
      summary: Add scene
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SceneCreateRequest'
      responses:
        "201":
          description: Created scene
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectScene'
        "404":
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectId}/scenes/{sceneId}:
    patch:
      summary: Update scene
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
        - in: path
          name: sceneId
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SceneUpdateRequest'
      responses:
        "200":
          description: Updated scene
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectScene'
        "404":
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete scene
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
        - in: path
          name: sceneId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "404":
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectId}/scenes/reorder:
    put:
      summary: Reorder scenes
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SceneReorderRequest'
      responses:
        "200":
          description: Reordered
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  scenes:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: string }
                        sceneNumber: { type: integer }

  /api/projects/{projectId}/scenes/{sceneId}/regenerate:
    post:
      summary: Regenerate a scene with AI
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema: { type: string }
        - in: path
          name: sceneId
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegenerateSceneRequest'
      responses:
        "200":
          description: Regenerated scene
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectScene'
        "404":
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example: { "message": "Authentication required" }
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example: { "message": "Forbidden" }
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example: { "message": "Not found" }
    OutOfCredits:
      description: Not enough AI credits
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example: { "message": "You have no AI credits left. Please top up to generate more scripts." }

  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
    SignupRequest:
      type: object
      required: [email, password, username, displayName]
      properties:
        email: { type: string, format: email }
        password: { type: string, minLength: 6 }
        username: { type: string, minLength: 3 }
        displayName: { type: string }
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string, minLength: 6 }
    AuthTokens:
      type: object
      properties:
        accessToken: { type: string }
        refreshToken: { type: string }
    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        tokens:
          $ref: '#/components/schemas/AuthTokens'
    ContactRequest:
      type: object
      required: [name, email, subject, message]
      properties:
        name: { type: string, minLength: 2 }
        email: { type: string, format: email }
        subject: { type: string, minLength: 3, maxLength: 120 }
        message: { type: string, minLength: 10, maxLength: 2000 }

    User:
      type: object
      properties:
        id: { type: string }
        email: { type: string }
        username: { type: string }
        displayName: { type: string }
        avatar: { type: string }
        coverPhoto: { type: string }
        bio: { type: string }
        joinedAt: { type: string, format: date-time }
        level: { type: integer }
        isOnline: { type: boolean }
        aiCredits: { type: integer, minimum: 0, description: "Remaining AI script credits" }
        role: { type: string, enum: [user, moderator, admin] }
        followerCount: { type: integer }
        isFollowing: { type: boolean }
        badges:
          type: array
          items:
            type: string
            enum: [verified, platinum, gold, moderator, contributor]
    UserUpdateRequest:
      type: object
      properties:
        bio: { type: string, maxLength: 280 }
        avatar: { type: string, format: uri }
        coverPhoto: { type: string, format: uri }

    Category:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        icon: { type: string }
        color: { type: string }

    CodeBlock:
      type: object
      properties:
        language: { type: string }
        snippet: { type: string }

    Post:
      type: object
      properties:
        id: { type: string }
        author: { $ref: '#/components/schemas/User' }
        categoryId: { type: string }
        title: { type: string, nullable: true }
        content: { type: string }
        code: { $ref: '#/components/schemas/CodeBlock' }
        images:
          type: array
          items: { type: string }
        createdAt: { type: string, format: date-time }
        displayTime: { type: string, description: "Human friendly relative time (up to 3 days) or date" }
        tags:
          type: array
          items: { type: string }
        likes: { type: integer }
        comments: { type: integer }
        shares: { type: integer }
        isPinned: { type: boolean }
        isSolved: { type: boolean }
        isEdited: { type: boolean }
        isLiked: { type: boolean }
        isBookmarked: { type: boolean }
    CourseCategory:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        slug: { type: string }
        description: { type: string }
        icon: { type: string }
        color: { type: string }
    Course:
      type: object
      properties:
        id: { type: string }
        author: { $ref: '#/components/schemas/User' }
        title: { type: string }
        slug: { type: string }
        description: { type: string }
        content: { type: string }
        thumbnail: { type: string }
        category: { type: string }
        difficulty: { type: string, enum: [beginner, intermediate, advanced] }
        durationMinutes: { type: integer }
        lessonsCount: { type: integer }
        enrolledCount: { type: integer }
        isPublished: { type: boolean }
        isFeatured: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    CourseCreateRequest:
      type: object
      required: [title, description, content, category, difficulty]
      properties:
        title: { type: string }
        description: { type: string }
        content: { type: string }
        thumbnail: { type: string }
        category: { type: string }
        difficulty: { type: string, enum: [beginner, intermediate, advanced] }
        durationMinutes: { type: integer }
        lessonsCount: { type: integer }
        isPublished: { type: boolean }
        isFeatured: { type: boolean }
    CourseUpdateRequest:
      type: object
      properties:
        title: { type: string }
        description: { type: string }
        content: { type: string }
        thumbnail: { type: string }
        category: { type: string }
        difficulty: { type: string, enum: [beginner, intermediate, advanced] }
        durationMinutes: { type: integer }
        lessonsCount: { type: integer }
        isPublished: { type: boolean }
        isFeatured: { type: boolean }
    CourseLesson:
      type: object
      properties:
        id: { type: string }
        courseId: { type: string }
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        durationMinutes: { type: integer }
        orderIndex: { type: integer }
        isFree: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    LessonCreateRequest:
      type: object
      required: [title, content]
      properties:
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        durationMinutes: { type: integer }
        orderIndex: { type: integer }
        isFree: { type: boolean }
    LessonUpdateRequest:
      type: object
      properties:
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        durationMinutes: { type: integer }
        orderIndex: { type: integer }
        isFree: { type: boolean }
    CourseProgress:
      type: object
      properties:
        courseId: { type: string }
        completedLessons:
          type: array
          items: { type: string }
        progressPercent: { type: integer }
        lessonsCount: { type: integer }
        startedAt: { type: string, format: date-time }
        lastAccessedAt: { type: string, format: date-time }
        completedAt: { type: string, format: date-time, nullable: true }
    PostCreateRequest:
      type: object
      required: [content, categoryId]
      properties:
        title: { type: string, nullable: true }
        content: { type: string }
        categoryId: { type: string }
        code: { $ref: '#/components/schemas/CodeBlock' }
        images:
          type: array
          items: { type: string, format: uri }
          maxItems: 4
        tags:
          type: array
          items: { type: string }
          maxItems: 5
    PostUpdateRequest:
      type: object
      properties:
        title: { type: string, nullable: true }
        content: { type: string }
        categoryId: { type: string }
        code: { $ref: '#/components/schemas/CodeBlock' }
        images:
          type: array
          items: { type: string, format: uri }
        tags:
          type: array
          items: { type: string }
        isPinned: { type: boolean }
        isSolved: { type: boolean }

    Comment:
      type: object
      properties:
        id: { type: string }
        postId: { type: string }
        reelId: { type: string }
        author: { $ref: '#/components/schemas/User' }
        content: { type: string }
        code: { $ref: '#/components/schemas/CodeBlock' }
        images:
          type: array
          items: { type: string }
        createdAt: { type: string, format: date-time }
        displayTime: { type: string, description: "Human friendly relative time (up to 3 days) or date" }
        likes: { type: integer }
        parentId: { type: string, nullable: true }
        repliesCount: { type: integer }
        isLiked: { type: boolean }
        isAccepted: { type: boolean }
        isEdited: { type: boolean }
    Reel:
      type: object
      properties:
        id: { type: string }
        author: { $ref: '#/components/schemas/User' }
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        thumbnail: { type: string }
        durationSeconds: { type: number }
        tags:
          type: array
          items: { type: string }
        views: { type: integer }
        totalWatchSeconds: { type: number }
        averageWatchSeconds: { type: number }
        lastViewedAt: { type: string, format: date-time }
        likes: { type: integer }
        shares: { type: integer }
        comments: { type: integer }
        isLiked: { type: boolean }
        isBookmarked: { type: boolean }
        createdAt: { type: string, format: date-time }
        displayTime: { type: string }
    ReelCreateRequest:
      type: object
      required: [videoUrl]
      properties:
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        thumbnail: { type: string }
        durationSeconds: { type: number }
        tags:
          type: array
          items: { type: string }
          maxItems: 5
    ReelUpdateRequest:
      type: object
      properties:
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        thumbnail: { type: string }
        durationSeconds: { type: number }
        tags:
          type: array
          items: { type: string }
          maxItems: 5
    CommentCreateRequest:
      type: object
      required: [content]
      properties:
        postId: { type: string }
        reelId: { type: string }
        content: { type: string }
        code: { $ref: '#/components/schemas/CodeBlock' }
        images:
          type: array
          items: { type: string, format: uri }
          maxItems: 4
        parentId: { type: string }
    CommentUpdateRequest:
      type: object
      properties:
        content: { type: string }
        code: { $ref: '#/components/schemas/CodeBlock' }
        images:
          type: array
          items: { type: string, format: uri }
        isAccepted: { type: boolean }

    Notification:
      type: object
      properties:
        id: { type: string }
        type: { type: string, enum: [like, comment, mention, follow] }
        actor: { $ref: '#/components/schemas/User' }
        postId: { type: string }
        commentId: { type: string }
        postTitle: { type: string }
        post: { $ref: '#/components/schemas/Post' }
        comment: { $ref: '#/components/schemas/Comment' }
        createdAt: { type: string, format: date-time }
        isRead: { type: boolean }

    CommunityStats:
      type: object
      properties:
        activeOnline: { type: integer }
        postsToday: { type: integer }
        questionsSolved: { type: integer }

    UploadResponse:
      type: object
      properties:
        urls:
          type: array
          items: { type: string }
    ProjectScene:
      type: object
      properties:
        id: { type: string }
        sceneNumber: { type: integer }
        description: { type: string }
        imagePrompt: { type: string }
        bRollPrompt: { type: string }
        duration: { type: integer, maximum: 6 }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    AiScene:
      type: object
      properties:
        sceneNumber: { type: integer }
        description: { type: string }
        imagePrompt: { type: string }
        bRollPrompt: { type: string }
        duration: { type: integer, maximum: 6 }
    Project:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        topic: { type: string }
        description: { type: string }
        status: { type: string, enum: [draft, in-progress, completed] }
        style:
          type: string
          enum:
            - 4k-realistic
            - clay
            - cinematic
            - brick
            - grudge
            - comic-book
            - muppet
            - ghibli
            - playground
            - voxel
            - anime
            - pixer-3d
        scenesCount: { type: integer }
        totalDuration: { type: number, description: "Total duration of scenes (seconds)" }
        averageSceneDuration: { type: number, description: "Average duration per scene (seconds)" }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    ProjectDetail:
      allOf:
        - $ref: '#/components/schemas/Project'
        - type: object
          properties:
            scenes:
              type: array
              items: { $ref: '#/components/schemas/ProjectScene' }
    ProjectCreateRequest:
      type: object
      required: [title]
      properties:
        title: { type: string }
        topic: { type: string, description: "Derived from script if omitted" }
        description: { type: string }
        generateScenes: { type: boolean }
        sceneCount: { type: integer, minimum: 1, maximum: 20 }
        script:
          type: string
          description: "User-provided script to split into 5s scenes (required when generateScenes is true)"
        scenes:
          type: array
          maxItems: 50
          description: "Optional scenes to save with the project"
          items:
            type: object
            properties:
              sceneNumber: { type: integer, description: "Defaults to order provided" }
              description: { type: string }
              imagePrompt: { type: string }
              bRollPrompt: { type: string }
              duration: { type: integer, minimum: 1, maximum: 6 }
        style:
          type: string
          enum:
            - 4k-realistic
            - clay
            - cinematic
            - brick
            - grudge
            - comic-book
            - muppet
            - ghibli
            - playground
            - voxel
            - anime
            - pixer-3d
    ProjectUpdateRequest:
      type: object
      properties:
        title: { type: string }
        description: { type: string }
        status: { type: string, enum: [draft, in-progress, completed] }
        style:
          type: string
          enum:
            - 4k-realistic
            - clay
            - cinematic
            - brick
            - grudge
            - comic-book
            - muppet
            - ghibli
            - playground
            - voxel
            - anime
            - pixer-3d
    SceneCreateRequest:
      type: object
      required: [description]
      properties:
        description: { type: string }
        imagePrompt: { type: string }
        bRollPrompt: { type: string }
        duration: { type: integer, minimum: 1, maximum: 6, description: "Seconds (max 6)" }
        position: { type: integer, description: "Insert position (1-based)" }
    SceneUpdateRequest:
      type: object
      properties:
        description: { type: string }
        imagePrompt: { type: string }
        bRollPrompt: { type: string }
        duration: { type: integer, minimum: 1, maximum: 6, description: "Seconds (max 6)" }
    SceneReorderRequest:
      type: object
      required: [sceneIds]
      properties:
        sceneIds:
          type: array
          items: { type: string }
    RegenerateSceneRequest:
      type: object
      properties:
        context: { type: string }
        instructions: { type: string }
        topic: { type: string }
        script: { type: string }
    GenerateScenesRequest:
      type: object
      required: [script]
      properties:
        topic: { type: string }
        script:
          type: string
          description: "Script text to split into scenes (required)"
        sceneCount: { type: integer, minimum: 1, maximum: 20 }
        style:
          type: string
          enum:
            - 4k-realistic
            - clay
            - cinematic
            - brick
            - grudge
            - comic-book
            - muppet
            - ghibli
            - playground
            - voxel
            - anime
            - pixer-3d
    GenerateScenesResponse:
      type: object
      properties:
        scenes:
          type: array
          items: { $ref: '#/components/schemas/AiScene' }
        totalDuration: { type: number, description: "Total seconds across scenes" }
        averageSceneDuration: { type: number, description: "Average seconds per scene" }
        bRollCount: { type: integer, description: "Number of scene/b-roll prompts" }
    GenerateVideoRequest:
      type: object
      properties:
        provider:
          type: string
          enum: [openai, gemini, veo]
    VideoGenerationResponse:
      type: object
      properties:
        status:
          type: string
          enum: [completed, processing]
        provider:
          type: string
          enum: [veo]
        projectId:
          type: string
        scenesCount:
          type: integer
        operationName:
          type: string
          nullable: true
        videos:
          type: array
          items:
            type: object
            properties:
              uri: { type: string }
    VideoStatusResponse:
      type: object
      properties:
        status:
          type: string
          enum: [completed, processing, pending]
        provider:
          type: string
          enum: [veo]
        videoUri:
          type: string
          nullable: true
        operationName:
          type: string
          nullable: true
    GenerateScriptRequest:
      type: object
      description: Provide either a prompt or both topicCategory and format.
      properties:
        prompt:
          type: string
          maxLength: 4000
        language:
          type: string
          default: en
        duration:
          type: string
          default: 60s
        topicCategory:
          type: string
          description: Category id used when asking for a random script.
        format:
          type: string
          description: Format id used when asking for a random script.
    GenerateScriptResponse:
      type: object
      properties:
        script: { type: string }
        topic:
          type: string
          description: Present when the backend picked a random topic.
        format:
          type: string
          description: Human-readable format label echoed back to the UI.
        usage:
          type: object
          properties:
            promptTokens: { type: integer }
            completionTokens: { type: integer }
            totalTokens: { type: integer }
            model: { type: string }
        creditsRemaining:
          type: integer
          description: AI credits left after this request
    AiConversationListItem:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        updatedAt: { type: string, format: date-time }
        lastMessageSnippet: { type: string }
    AiConversation:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        flowStep: { type: string }
        generatedScript: { type: string }
        selectedTopic: { type: string }
        selectedTopicId: { type: string }
        selectedFormat: { type: string }
        selectedFormatId: { type: string }
        selectedStyle:
          type: object
          description: Style metadata echoed from the frontend
        selectedDuration: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    AiConversationWithMessages:
      allOf:
        - $ref: '#/components/schemas/AiConversation'
        - type: object
          properties:
            messages:
              type: array
              items:
                $ref: '#/components/schemas/AiConversationMessage'
    SceneSequence:
      type: object
      properties:
        sceneNumber: { type: integer }
        audioCaption: { type: string }
        videoPrompt: { type: string }
        imagePrompt: { type: string }
        duration: { type: integer, nullable: true, description: "Seconds" }
    AiConversationMessage:
      type: object
      properties:
        id: { type: string }
        role:
          type: string
          enum: [assistant, user]
        content: { type: string }
        options:
          type: object
          nullable: true
          description: Optional metadata/options echoed from the UI
        scenes:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/SceneSequence'
        createdAt: { type: string, format: date-time }
    CreateAiConversationRequest:
      type: object
      properties:
        title: { type: string }
    UpdateAiConversationRequest:
      type: object
      properties:
        title: { type: string }
        flowStep: { type: string }
        generatedScript: { type: string }
        selectedTopic: { type: string }
        selectedTopicId: { type: string }
        selectedFormat: { type: string }
        selectedFormatId: { type: string }
        selectedStyle: { type: object }
        selectedDuration: { type: string }
    CreateAiMessageRequest:
      type: object
      required: [role, content]
      properties:
        role:
          type: string
          enum: [assistant, user]
        content: { type: string }
        options:
          type: object
          nullable: true
        scenes:
          type: array
          items:
            $ref: '#/components/schemas/SceneSequence'
    VideoFromScriptRequest:
      type: object
      required: [script]
      properties:
        script: { type: string, maxLength: 5000 }
        style:
          type: string
          enum:
            - 4k-realistic
            - clay
            - cinematic
            - brick
            - grudge
            - comic-book
            - muppet
            - ghibli
            - playground
            - voxel
            - anime
            - pixer-3d
    VideoFromScriptResponse:
      type: object
      properties:
        id: { type: string }
        status: { type: string, enum: [completed] }
        provider: { type: string, enum: [veo] }
        operationName: { type: string, nullable: true }
        videoUri: { type: string, nullable: true }
        topic: { type: string }
        sequences:
          type: array
          items:
            type: object
            properties:
              sequenceNumber: { type: integer }
              audio: { type: string }
              imagePrompt: { type: string }
              bRollPrompt: { type: string }
              duration: { type: integer, minimum: 1, maximum: 6 }
              audioDataUri: { type: string, nullable: true }
              imageDataUri: { type: string, nullable: true }
    VideoGenerationItem:
      type: object
      properties:
        id: { type: string }
        script: { type: string }
        style: { type: string }
        topic: { type: string }
        provider: { type: string }
        videoUri: { type: string, nullable: true }
        sequences:
          type: array
          items:
            type: object
            properties:
              sequenceNumber: { type: integer }
              audio: { type: string }
              imagePrompt: { type: string }
              bRollPrompt: { type: string }
              duration: { type: integer, minimum: 1, maximum: 6 }
              audioDataUri: { type: string, nullable: true }
              imageDataUri: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    VideoGenerationStatus:
      type: object
      properties:
        id: { type: string }
        status: { type: string, enum: [pending, processing, completed, failed] }
        progress: { type: integer }
        videoUri: { type: string, nullable: true }

    PostPage:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Post' }
        nextCursor:
          type: string
          nullable: true
    CommentPage:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Comment' }
        nextCursor:
          type: string
          nullable: true
    NotificationPage:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Notification' }
        nextCursor:
          type: string
          nullable: true

  examples:
    PostExample:
      id: 66fbc3aa0f1b8d001232abcd
      author:
        id: 66fbc3990f1b8d001232aaaa
        username: janedoe
        displayName: Jane Doe
        avatar: https://example.com/avatar.jpg
        bio: "Frontend learner"
        joinedAt: "2024-05-01T10:00:00.000Z"
        level: 3
        isOnline: true
        role: user
      categoryId: 66fbc3aa0f1b8d001232abcd
      title: "How to center a div?"
      content: "I can't get flex to work. Any tips?"
      createdAt: "2025-12-07T12:55:00.000Z"
      tags: ["css", "help"]
      likes: 5
      comments: 2
      shares: 0
      isPinned: false
      isSolved: false
      isEdited: false
      isLiked: true
      isBookmarked: false
